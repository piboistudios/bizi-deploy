---
kind: BackEnd
stack:
  version: "2.0"
  services:
    mongo:
      image: "mongo:4.2.23"
      params:
        storage:
          data:
            mount: /data/db
      expose:
        - port: 27017
          as: 27017
          proto: tcp
          to:
            {{#each internal.appList}}
            - service: {{ this.name }}
            {{/each}}
      env:
        - MONGO_INITDB_ROOT_USERNAME={{internal.db.user}}
        - MONGO_INITDB_ROOT_PASSWORD={{internal.db.pass}}
    redis:
      image: "redis:7.0.7"
      expose:
        - port: 6379
          as: 6379
          proto: tcp
          to:
            {{#each internal.appList}}
            - service: {{ this.name }}
            {{/each}}
    
  profiles:
    compute:
      mongo:
        resources:
          cpu:
            units: 0.5
          memory:
            size: 4Gi
          storage:
            - size: 4Gi
            - size: 16Gi
              name: data
              attributes:
                persistent: true
                class: beta1
      redis:
        resources:
          cpu:
            units: 0.5
          memory:
            size: 1Gi
          storage:
            - size: 512Mi
      
    placement:
      central:
        pricing:
          
          mongo:
            denom: uakt
            amount: 1000
          redis:
            denom: uakt
            amount: 1000
        signedBy:
          anyOf:
            - akash1365yvmc4s7awdyj3n2sav7xfx76adc6dnmlx63
            - akash18qa2a2ltfyvkyj0ggj3hkvuj6twzyumuaru9s4
        attributes:
          host: akash

  deployment:
    mongo:
      central:
        profile: mongo
        count: 1
    redis:
      central:
        profile: redis
        count: 1

  